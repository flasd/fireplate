'use strict';var _react=require('react'),_react2=babelHelpers.interopRequireDefault(_react),_reactHelmet=require('react-helmet'),_reactHelmet2=babelHelpers.interopRequireDefault(_reactHelmet),_cheerio=require('cheerio'),_cheerio2=babelHelpers.interopRequireDefault(_cheerio),_express=require('express'),_express2=babelHelpers.interopRequireDefault(_express),_fs=require('fs'),_fs2=babelHelpers.interopRequireDefault(_fs),_firebaseFunctions=require('firebase-functions'),_firebaseFunctions2=babelHelpers.interopRequireDefault(_firebaseFunctions),_helmet=require('helmet'),_helmet2=babelHelpers.interopRequireDefault(_helmet),_expressSession=require('express-session'),_expressSession2=babelHelpers.interopRequireDefault(_expressSession),_server=require('react-dom/server'),_reactRouter=require('react-router'),_app=require('./app'),_app2=babelHelpers.interopRequireDefault(_app),app=(0,_express2.default)(),cookieSecrets=['jJ6#@3A5xL','9cMb*l2U1P','a2n$oJ15X6'],template=_fs2.default.readFileSync('./public/index.html');function render(a,b){var c=_cheerio2.default.load(template);return c('title').replaceWith(a.title.toString()),c('head').append(a.meta.toString()),c('#root').html(b),c.html()}app.use((0,_helmet2.default)()),app.use((0,_expressSession2.default)({cookie:{secure:!0},secret:cookieSecrets}));var _ref=babelHelpers.jsx(_app2.default,{});app.get('*',function(a,b){var c={},d=(0,_server.renderToString)(babelHelpers.jsx(_reactRouter.StaticRouter,{location:a.url,context:c},void 0,_ref)),e=_reactHelmet2.default.renderStatic();return c.url?b.redirect(302,c.url):b.status(200).send(render(e,d))}),exports.app=_firebaseFunctions2.default.onRequest(app);